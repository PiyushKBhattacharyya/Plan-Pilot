<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PlanPilot</title>
    <link rel="stylesheet" href="{{styleUri}}">
</head>
<body>
    <div class="container">
        <!-- Enhanced Header -->
        <div class="header">
            <div class="logo-section">
                <div class="logo-icon">ğŸ¯</div>
                <div class="brand-info">
                    <div class="title">PlanPilot</div>
                    <div class="subtitle">AI Planning Assistant</div>
                </div>
            </div>
            <div class="header-actions">
                <button class="btn-icon" onclick="refreshPlans()" title="Refresh">ğŸ”„</button>
                <button class="btn-icon" onclick="showSettings()" title="Settings">âš™ï¸</button>
                <button class="btn-icon" onclick="toggleTheme()" title="Toggle Theme">ğŸŒ™</button>
            </div>
        </div>

        <!-- Quick Actions Bar -->
        <div class="quick-actions">
            <button class="btn btn-primary-large" onclick="generatePlan()">
                <span class="btn-icon">ğŸš€</span>
                Generate Plan
            </button>
            <div class="quick-action-grid">
                <button class="btn btn-secondary btn-small" onclick="importPlan()" title="Import Plan">
                    <span class="btn-icon">ğŸ“¥</span>
                    Import
                </button>
                <button class="btn btn-secondary btn-small" onclick="showTemplates()" title="Templates">
                    <span class="btn-icon">ğŸ“‹</span>
                    Templates
                </button>
                <button class="btn btn-secondary btn-small" onclick="analyzeProject()" title="Analyze Project">
                    <span class="btn-icon">ğŸ”</span>
                    Analyze
                </button>
            </div>
        </div>

        <!-- Generate Section -->
        <div class="generate-section">
            <div class="section-header">
                <h3>ğŸ“‹ New Implementation Plan</h3>
                <p class="section-description">Describe your development objective to generate a detailed plan</p>
            </div>
            
            <div class="form-group">
                <label for="objective">Development Objective *</label>
                <textarea 
                    id="objective" 
                    placeholder="Example: Build a real-time chat system with user authentication, message history, and file sharing capabilities..."
                    rows="4"
                    class="enhanced-textarea"
                ></textarea>
                <div class="char-count" id="charCount">0 characters</div>
            </div>

            <!-- Enhanced Context Section -->
            <div class="context-section">
                <div class="context-header">
                    <label class="context-label">
                        <span class="label-icon">ğŸ“„</span>
                        Project Context
                    </label>
                    <div class="context-actions">
                        <button class="btn btn-small btn-secondary" onclick="loadWorkspaceFiles()">
                            <span class="btn-icon">ğŸ“‚</span>
                            Browse Files
                        </button>
                        <button class="btn btn-small btn-secondary" onclick="detectTechStack()">
                            <span class="btn-icon">ğŸ”</span>
                            Auto-Detect
                        </button>
                    </div>
                </div>

                <div id="selectedFiles" class="file-browser hidden">
                    <div class="file-browser-header">
                        <span class="file-count" id="fileCount">0 files selected</span>
                        <button class="btn-text" onclick="clearFiles()">Clear All</button>
                    </div>
                    <div class="file-list" id="fileBrowser"></div>
                </div>

                <div id="contextSummary" class="context-summary hidden">
                    <div class="context-chips">
                        <div class="context-item">
                            <strong class="context-label-small">Files:</strong>
                            <div id="selectedFilesList" class="selected-files-list"></div>
                        </div>
                        <div class="context-item">
                            <strong class="context-label-small">Tech Stack:</strong>
                            <div id="techStackList" class="tech-stack-list"></div>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label for="notes">Additional Requirements</label>
                    <textarea 
                        id="notes" 
                        placeholder="Add specific requirements, constraints, or preferences..."
                        rows="3"
                        class="notes-textarea"
                    ></textarea>
                </div>
            </div>

            <div id="progressContainer" class="progress-container hidden">
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill" style="width: 0%"></div>
                </div>
                <div class="progress-text" id="progressText">Generating plan...</div>
            </div>

            <button id="generateBtn" class="btn btn-primary btn-generate" onclick="generatePlan()">
                <span class="btn-icon">ğŸš€</span>
                Generate Implementation Plan
            </button>
        </div>

        <!-- Enhanced Plans Section -->
        <div class="plans-section">
            <div class="section-header">
                <div class="section-title-group">
                    <h3 class="section-title">ğŸ“‹ Your Plans</h3>
                    <div class="plans-count" id="plansCount">0 plans</div>
                </div>
                <div class="section-actions">
                    <div class="view-controls">
                        <button class="btn-icon view-btn active" data-view="cards" onclick="switchView('cards')" title="Card View">ğŸ—ƒï¸</button>
                        <button class="btn-icon view-btn" data-view="list" onclick="switchView('list')" title="List View">ğŸ“‹</button>
                        <button class="btn-icon view-btn" data-view="timeline" onclick="switchView('timeline')" title="Timeline View">ğŸ“…</button>
                    </div>
                    <div class="filter-controls">
                        <select id="statusFilter" class="filter-select" onchange="filterPlans()">
                            <option value="all">All Status</option>
                            <option value="draft">Draft</option>
                            <option value="in_progress">In Progress</option>
                            <option value="completed">Completed</option>
                        </select>
                    </div>
                    <button class="btn-icon" onclick="refreshPlans()" title="Refresh">ğŸ”„</button>
                </div>
            </div>
            <div id="plansContainer" class="plans-container">
                <div class="loading-state">
                    <div class="loading-spinner"></div>
                    <span>Loading plans...</span>
                </div>
            </div>
        </div>

        <!-- Plan Detail Modal -->
        <div id="planDetailModal" class="modal hidden">
            <div class="modal-content plan-modal">
                <div class="modal-header">
                    <h2 id="modalPlanTitle">Plan Details</h2>
                    <div class="modal-actions">
                        <button class="btn btn-small btn-secondary" onclick="openPlanInWindow(currentModalPlanId)" title="Open in Window">
                            <span class="btn-icon">ğŸªŸ</span>
                            New Window
                        </button>
                        <button class="btn btn-small btn-secondary" onclick="exportPlan(currentModalPlanId)" title="Export">
                            <span class="btn-icon">ğŸ“¤</span>
                            Export
                        </button>
                        <button class="btn-icon" onclick="closePlanModal()">âœ•</button>
                    </div>
                </div>
                <div class="modal-body" id="modalPlanContent">
                    <!-- Plan content will be inserted here -->
                </div>
            </div>
        </div>

        <!-- Enhanced Export Options Modal -->
        <div id="exportModal" class="modal hidden">
            <div class="modal-content export-modal">
                <div class="modal-header">
                    <h3>Export Plan</h3>
                    <button class="btn-icon" onclick="closeExportModal()">âœ•</button>
                </div>
                <div class="modal-body">
                    <p class="export-description">Choose your export format and customize options:</p>
                    
                    <div class="export-categories">
                        <div class="export-category">
                            <h4>AI Assistants</h4>
                            <div class="export-grid">
                                <div class="export-option" onclick="exportPlan(currentExportPlanId, 'cursor')">
                                    <div class="export-icon">ğŸ¯</div>
                                    <div class="export-info">
                                        <h5>Cursor AI</h5>
                                        <p>Optimized prompts for Cursor editor with context-aware instructions</p>
                                    </div>
                                </div>
                                <div class="export-option" onclick="exportPlan(currentExportPlanId, 'claude')">
                                    <div class="export-icon">ğŸ¤–</div>
                                    <div class="export-info">
                                        <h5>Claude AI</h5>
                                        <p>Detailed explanations and architectural guidance for Claude</p>
                                    </div>
                                </div>
                                <div class="export-option" onclick="exportPlan(currentExportPlanId, 'windsurf')">
                                    <div class="export-icon">ğŸŒŠ</div>
                                    <div class="export-info">
                                        <h5>Windsurf</h5>
                                        <p>IDE-integrated workflows with task management</p>
                                    </div>
                                </div>
                                <div class="export-option" onclick="exportPlan(currentExportPlanId, 'copilot')">
                                    <div class="export-icon">ğŸš</div>
                                    <div class="export-info">
                                        <h5>GitHub Copilot</h5>
                                        <p>Structured comments and implementation hints</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="export-category">
                            <h4>Standard Formats</h4>
                            <div class="export-grid">
                                <div class="export-option" onclick="exportPlan(currentExportPlanId, 'markdown')">
                                    <div class="export-icon">ğŸ“</div>
                                    <div class="export-info">
                                        <h5>Markdown</h5>
                                        <p>Clean documentation format for any platform</p>
                                    </div>
                                </div>
                                <div class="export-option" onclick="exportPlan(currentExportPlanId, 'json')">
                                    <div class="export-icon">âš¡</div>
                                    <div class="export-info">
                                        <h5>JSON Data</h5>
                                        <p>Structured data for custom integrations and tools</p>
                                    </div>
                                </div>
                                <div class="export-option" onclick="exportPlan(currentExportPlanId, 'checklist')">
                                    <div class="export-icon">âœ…</div>
                                    <div class="export-info">
                                        <h5>Task Checklist</h5>
                                        <p>Simple checkbox format for progress tracking</p>
                                    </div>
                                </div>
                                <div class="export-option" onclick="exportPlan(currentExportPlanId, 'pdf')">
                                    <div class="export-icon">ğŸ“„</div>
                                    <div class="export-info">
                                        <h5>PDF Report</h5>
                                        <p>Professional document for sharing and archival</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="export-category">
                            <h4>Project Management</h4>
                            <div class="export-grid">
                                <div class="export-option" onclick="exportPlan(currentExportPlanId, 'jira')">
                                    <div class="export-icon">ğŸ«</div>
                                    <div class="export-info">
                                        <h5>Jira Tickets</h5>
                                        <p>Ready-to-import user stories and tasks</p>
                                    </div>
                                </div>
                                <div class="export-option" onclick="exportPlan(currentExportPlanId, 'trello')">
                                    <div class="export-icon">ğŸ“Š</div>
                                    <div class="export-info">
                                        <h5>Trello Cards</h5>
                                        <p>Board-ready cards with descriptions and checklists</p>
                                    </div>
                                </div>
                                <div class="export-option" onclick="exportPlan(currentExportPlanId, 'github')">
                                    <div class="export-icon">ğŸ™</div>
                                    <div class="export-info">
                                        <h5>GitHub Issues</h5>
                                        <p>Repository issues with labels and milestones</p>
                                    </div>
                                </div>
                                <div class="export-option" onclick="exportPlan(currentExportPlanId, 'notion')">
                                    <div class="export-icon">ğŸ“š</div>
                                    <div class="export-info">
                                        <h5>Notion Database</h5>
                                        <p>Structured pages ready for Notion import</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="export-options-panel">
                        <h4>Export Options</h4>
                        <div class="option-group">
                            <label class="checkbox-label">
                                <input type="checkbox" id="includeDetails" checked>
                                Include detailed implementation steps
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" id="includeCode" checked>
                                Include code examples and snippets
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" id="includeTimeline" checked>
                                Include timeline and estimates
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" id="includeDependencies">
                                Include dependency information
                            </label>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Templates Modal -->
        <div id="templatesModal" class="modal hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Plan Templates</h3>
                    <button class="btn-icon" onclick="closeTemplatesModal()">âœ•</button>
                </div>
                <div class="modal-body">
                    <div class="template-grid">
                        <div class="template-card" onclick="useTemplate('webapp')">
                            <div class="template-icon">ğŸŒ</div>
                            <h4>Web Application</h4>
                            <p>Full-stack web app with authentication, database, and API</p>
                        </div>
                        <div class="template-card" onclick="useTemplate('mobile')">
                            <div class="template-icon">ğŸ“±</div>
                            <h4>Mobile App</h4>
                            <p>Cross-platform mobile application development</p>
                        </div>
                        <div class="template-card" onclick="useTemplate('api')">
                            <div class="template-icon">ğŸ”Œ</div>
                            <h4>REST API</h4>
                            <p>Backend API service with documentation and testing</p>
                        </div>
                        <div class="template-card" onclick="useTemplate('microservice')">
                            <div class="template-icon">âš¡</div>
                            <h4>Microservice</h4>
                            <p>Containerized microservice with CI/CD pipeline</p>
                        </div>
                        <div class="template-card" onclick="useTemplate('dashboard')">
                            <div class="template-icon">ğŸ“Š</div>
                            <h4>Analytics Dashboard</h4>
                            <p>Data visualization and reporting interface</p>
                        </div>
                        <div class="template-card" onclick="useTemplate('ecommerce')">
                            <div class="template-icon">ğŸ›’</div>
                            <h4>E-commerce Site</h4>
                            <p>Online store with payment processing and inventory</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Import Modal -->
        <div id="importModal" class="modal hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Import Plan</h3>
                    <button class="btn-icon" onclick="closeImportModal()">âœ•</button>
                </div>
                <div class="modal-body">
                    <div class="import-options">
                        <div class="import-option" onclick="importFromFile()">
                            <div class="import-icon">ğŸ“</div>
                            <h4>From File</h4>
                            <p>Import from JSON, Markdown, or other formats</p>
                        </div>
                        <div class="import-option" onclick="importFromClipboard()">
                            <div class="import-icon">ğŸ“‹</div>
                            <h4>From Clipboard</h4>
                            <p>Paste plan data from clipboard</p>
                        </div>
                        <div class="import-option" onclick="importFromUrl()">
                            <div class="import-icon">ğŸŒ</div>
                            <h4>From URL</h4>
                            <p>Import from online source or GitHub</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Enhanced Status Bar -->
    <div class="status-bar" id="statusBar">
        <div class="status-left">
            <span class="status-text">Ready</span>
        </div>
        <div class="status-right">
            <span class="api-status" id="apiStatus">ğŸŸ¢ AI Ready</span>
            <span class="workspace-info" id="workspaceInfo"></span>
        </div>
    </div>

    <script src="{{scriptUri}}"></script>
</body>
</html>